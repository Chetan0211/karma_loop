<!--
comment - Contains the instance of a mocdel
-->
<div class="comment" id="<%= comment.id %>">
  <p><strong><%= comment.commenter.username %>:</strong></p>
  <%= comment.comment %>
  <div id="comment_reaction_<%=comment.id%>", class="<%=comment.current_user_reaction(current_user.id)%>">
    <span>
      <%= link_to "Like", post_comment_reaction_path(post_id: params[:id], comment_id: comment.id, reaction:comment.current_user_reaction(current_user.id) == 'like' ? nil:"like"), id:"comment_like_button_#{comment.id}",remote: true, data: { turbo_method: "get" } %>
      <span><%= (comment.likes - comment.dislikes).abs %></span>
      <%= link_to "Dislike", post_comment_reaction_path(post_id: params[:id], comment_id: comment.id, reaction:comment.current_user_reaction(current_user.id) == 'dislike' ? nil:"dislike"), id:"comment_dislike_button_#{comment.id}",remote: true, data: { turbo_method: "get" } %>
    </span>
  </div>
  <button id="reply_comment_button_<%= comment.id %>">Reply</button>
  <%= form_with url: post_add_comment_path(post_id: params[:id]), model: Comment.new, remote: true, id: "reply_comment_form_#{comment.id}", html: { style: "display: none;" } do |form| %>
    <%= form.hidden_field :parent_id, value: comment.id %>
    <div>
      <%= form.label :comment, "Add a Comment:" %>
      <%= form.rich_text_area :comment, id:"id:comment_comment_#{comment.id}" %>
    </div>
    <button id="cancel_reply_comment_form_<%= comment.id %>", type="button">Cancel</button>
    <%= form.submit "Post Comment" %>
  <% end %>
  <!-- Replies -->
  <% if comment.replies.any? %>
    <div class="replies">
      <% comment.replies.each do |reply| %>
        <%= render partial: 'shared/comment', locals: { comment: reply } %>
      <% end %>
    </div>
  <% end %>
</div>
<script>
  const reply_comment_button_<%= comment.id.gsub('-', '_') %> = document.getElementById("reply_comment_button_<%= comment.id %>");
  const reply_comment_form_<%= comment.id.gsub('-', '_') %> = document.getElementById("reply_comment_form_<%= comment.id %>");
  const cancel_reply_comment_form_<%= comment.id.gsub('-', '_') %> = document.getElementById("cancel_reply_comment_form_<%= comment.id %>");

  reply_comment_button_<%= comment.id.gsub('-', '_') %>.addEventListener("click", (event) => {
    reply_comment_button_<%= comment.id.gsub('-', '_') %>.style.display = "none";
    reply_comment_form_<%= comment.id.gsub('-', '_') %>.style.display = "block";
  });

  cancel_reply_comment_form_<%= comment.id.gsub('-', '_') %>.addEventListener("click", (event) => {
    reply_comment_button_<%= comment.id.gsub('-', '_') %>.style.display = "block";
    reply_comment_form_<%= comment.id.gsub('-', '_') %>.style.display = "none";
  });

  reply_comment_form_<%= comment.id.gsub('-', '_') %>.addEventListener("submit", (event) => {
    reply_comment_button_<%= comment.id.gsub('-', '_') %>.style.display = "block";
    reply_comment_form_<%= comment.id.gsub('-', '_') %>.style.display = "none";
  });
</script>
